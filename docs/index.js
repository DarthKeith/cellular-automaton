(()=>{function c(t){return Array(t).fill(0)}function d(t){return Math.floor(Math.random()*t)}function U(t){return c(t).map(()=>ot(t,t,t))}function F(t){return c(t).map(it)}function nt(t,e){return c(t).map(()=>d(e))}function ot(t,e,n){return c(t).map(()=>nt(e,n))}function it(){return[d(256),d(256),d(256)]}function y(t){return t===S?!1:(S=t,!0)}function f(){for(let t=0;t<a.length;t++)a[t]=d(S)}function Z(t){a=c(t),E=c(t),f()}function m(){O=U(S)}function L(){let t=a.slice();return rt(),t}var S,O,a,E;function rt(){let t=a.length-1;for(let e=0;e<=t;e++){let n=e===0?t:e-1,o=e===t?0:e+1;E[e]=O[a[n]][a[e]][a[o]]}[a,E]=[E,a]}var b=16.666666666666668,H=200,P=5,p=4,B=5,T=2;var r={numStatesButtons:document.getElementById("num-states-btns"),ruleButton:document.getElementById("rule-btn"),resetButton:document.getElementById("reset-btn"),cellSizeButtons:document.getElementById("cell-size-btns"),colorButton:document.getElementById("color-btn"),pauseButton:document.getElementById("pause-btn")};function W(){h(i,window.innerWidth,window.innerHeight);let t=Math.floor(i.width/s),e=1+Math.ceil(i.height/s);return h(l,t,e),h(G,t,1),v=at.createImageData(t,1),_=v.data,st(_),$(w),C=t*s,A=e*s,z=Math.floor((i.width-C)/2),u=-T,t}function q(){if(i.width!==window.innerWidth)return!1;h(i,window.innerWidth,window.innerHeight);let t=1+Math.ceil(i.height/s),e=g.getImageData(0,0,l.width,l.height);return h(l,l.width,t),g.putImageData(e,0,0),$(w),A=t*s,w.drawImage(l,z,u,C,A),!0}function X(){ft(),mt()}function R(t){if(u+=T,u>0){let e=Math.ceil(u/s);ut(e,t),u-=e*s}w.drawImage(l,z,u,C,A)}function I(){K=F(P)}function Y(t){return t===s?!1:(s=t,!0)}var D=document.getElementById("settings"),i=document.getElementById("canvas"),l=document.createElement("canvas"),G=document.createElement("canvas"),w=i.getContext("2d",{alpha:!1}),g=l.getContext("2d",{alpha:!1}),at=G.getContext("2d",{alpha:!1}),v,_,K,s=B,C,A,z,u;function lt(){D.style.display==="none"?(D.style.display="grid",i.style.cursor="default"):(D.style.display="none",i.style.cursor="none")}function h(t,e,n){t.width=e,t.height=n}function st(t){for(let e=3;e<t.length;e+=4)t[e]=255}function $(t){t.imageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msimageSmoothingEnabled=!1}function ct(t){let e=0;for(let n of t)[_[e],_[e+1],_[e+2]]=K[n],e+=4}function ut(t,e){let n=g.getImageData(0,0,l.width,l.height);for(g.putImageData(n,0,t);t>0;)t-=1,ct(e()),g.putImageData(v,0,t)}var j=t=>t.classList.add("selected"),dt=t=>t.classList.remove("selected");function ft(){i.addEventListener("click",lt);let t=o=>o.target.blur(),e=o=>o.addEventListener("click",t);document.querySelectorAll("button").forEach(e);function n(o){function tt(N){if(N.target.tagName==="BUTTON"){for(let et of o.children)dt(et);j(N.target)}}o.addEventListener("click",tt)}n(r.numStatesButtons),n(r.cellSizeButtons)}function mt(){function t(e,n){for(let o of e.children)if(parseInt(o.getAttribute("value"))===n){j(o);return}}t(r.numStatesButtons,p),t(r.cellSizeButtons,B)}function J(){y(p),m(),I(),X(),St(),M()}function Q(){let t=document.timeline.currentTime;function e(n){n-t>=b&&(k||R(L),t+=b),requestAnimationFrame(e)}requestAnimationFrame(e)}var k=!1;function M(){let t=W();Z(t),R(L)}function gt(t){Y(t)&&M()}function _t(t){y(t)&&(m(),f())}function V(){k=!k}function ht(){let t=0;function e(){q()||M()}function n(){clearTimeout(t),t=setTimeout(e,H)}return n}function Et(t){t.key===" "?V():t.key==="Backspace"?f():t.key==="c"?I():t.key==="Enter"&&m()}function St(){window.addEventListener("resize",ht()),window.addEventListener("keyup",Et),r.pauseButton.addEventListener("click",V),r.resetButton.addEventListener("click",f),r.colorButton.addEventListener("click",I),r.ruleButton.addEventListener("click",m);for(let t of r.cellSizeButtons.children){let e=parseInt(t.value);t.addEventListener("click",()=>gt(e))}for(let t of r.numStatesButtons.children){let e=parseInt(t.value);t.addEventListener("click",()=>_t(e))}}function x(){J(),Q()}x();})();
